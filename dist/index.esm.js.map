{"version":3,"file":"index.esm.js","sources":["../src/seasonal.ts","../src/weather.ts","../src/useSeasonalTheme.tsx","../src/useWeatherTheme.tsx","../src/provider/SeasonalUIProvider.tsx"],"sourcesContent":["export type SeasonKey = 'default' | 'halloween' | 'christmas' | 'thanksgiving' | 'easter';\r\n\r\nexport interface SeasonalConfig {\r\n  /** force a season (e.g., for screenshots) */\r\n  override?: SeasonKey | null;\r\n  /** timezone offset or explicit Date provider if you need server time */\r\n  now?: () => Date;\r\n  /** optional custom rules */\r\n  rules?: Array<(d: Date) => SeasonKey | null>;\r\n}\r\n\r\n/** Simple US-centric defaults; override via config.rules as needed. */\r\nexport function detectSeason(config: SeasonalConfig = {}): SeasonKey {\r\n  if (config.override) return config.override;\r\n  const now = (config.now ? config.now() : new Date());\r\n  const m = now.getMonth() + 1;\r\n  const day = now.getDate();\r\n\r\n  for (const r of config.rules ?? []) {\r\n    const res = r(now);\r\n    if (res) return res;\r\n  }\r\n\r\n  // Halloween: Oct 1–31\r\n  if (m === 10) return 'halloween';\r\n  // Thanksgiving: Nov 15–30\r\n  if (m === 11 && day >= 15 && day <= 30) return 'thanksgiving';\r\n  // Christmas: Dec 1–26\r\n  if (m === 12 && day <= 26) return 'christmas';\r\n\r\n  // Easter (approx): any Sunday in April → 'easter' (you can replace with real calc via config.rules)\r\n  if (m === 4) {\r\n    if (now.getDay() === 0) return 'easter';\r\n  }\r\n\r\n  return 'default';\r\n}\r\n\r\n/** Apply to <html data-season=\"...\"> */\r\nexport function applySeason(season: SeasonKey) {\r\n  document.documentElement.dataset.season = season;\r\n}\r\n","export type WeatherState = 'clear' | 'cloudy' | 'rain' | 'snow' | 'storm' | 'fog' | 'wind';\r\n\r\nexport interface WeatherOptions {\r\n  lat?: number;\r\n  lon?: number;\r\n  override?: WeatherState | null;  // e.g., ?weather=snow\r\n  timeoutMs?: number;              // geolocation timeout\r\n}\r\n\r\nexport async function getCoords(timeoutMs = 8000): Promise<{lat:number; lon:number} | null> {\r\n  if (!('geolocation' in navigator)) return null;\r\n  return new Promise((resolve) => {\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos) => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),\r\n      () => resolve(null),\r\n      { enableHighAccuracy: true, timeout: timeoutMs }\r\n    );\r\n  });\r\n}\r\n\r\nexport async function detectWeatherState(opts: WeatherOptions = {}): Promise<WeatherState> {\r\n  if (opts.override) return opts.override;\r\n\r\n  const lat = opts.lat;\r\n  const lon = opts.lon;\r\n\r\n  let coords = (lat && lon) ? {lat, lon} : (await getCoords(opts.timeoutMs ?? 8000));\r\n  if (!coords) coords = { lat: 40.7128, lon: -74.0060 }; // NYC fallback\r\n\r\n  const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=weather_code,precipitation,wind_speed_10m`;\r\n  const r = await fetch(url);\r\n  const j = await r.json();\r\n  const code: number = j?.current?.weather_code ?? 0;\r\n  const wind: number = j?.current?.wind_speed_10m ?? 0;\r\n\r\n  if ([71,73,75,77,85,86].includes(code)) return 'snow';\r\n  if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'rain';\r\n  if ([95,96,99].includes(code)) return 'storm';\r\n  if ([45,48].includes(code)) return 'fog';\r\n  if (wind >= 12 && [0,1,2,3].includes(code)) return 'wind';\r\n  if ([1,2,3].includes(code)) return 'cloudy';\r\n  return 'clear';\r\n}\r\n\r\nexport function applyWeather(wx: WeatherState) {\r\n  document.documentElement.dataset.wx = wx;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { detectSeason, applySeason, SeasonKey } from './seasonal';\r\n\r\nconst PARAM = 'season';\r\n\r\nexport function useSeasonalTheme(init?: {override?: SeasonKey | null}) {\r\n  const [season, setSeason] = useState<SeasonKey>('default');\r\n\r\n  useEffect(() => {\r\n    const qs = new URLSearchParams(location.search).get(PARAM) as SeasonKey | null;\r\n    const s = detectSeason({ override: init?.override ?? qs });\r\n    applySeason(s);\r\n    setSeason(s);\r\n  }, []);\r\n\r\n  return season;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { detectWeatherState, applyWeather, WeatherState } from './weather';\r\n\r\nconst PARAM = 'weather';\r\nconst CACHE_KEY = 'seasonal-ui:wx';\r\nconst TTL_MS = 15 * 60 * 1000;\r\n\r\nfunction getCached(): {wx: WeatherState; t: number} | null {\r\n  try { return JSON.parse(localStorage.getItem(CACHE_KEY) || 'null'); } catch { return null; }\r\n}\r\n\r\nexport function useWeatherTheme() {\r\n  const [wx, setWx] = useState<WeatherState>('clear');\r\n\r\n  useEffect(() => {\r\n    const manual = new URLSearchParams(location.search).get(PARAM) as WeatherState | null;\r\n    if (manual) {\r\n      applyWeather(manual);\r\n      setWx(manual);\r\n      return;\r\n    }\r\n\r\n    const cached = getCached();\r\n    if (cached && Date.now() - cached.t < TTL_MS) {\r\n      applyWeather(cached.wx);\r\n      setWx(cached.wx);\r\n      return;\r\n    }\r\n\r\n    (async () => {\r\n      const state = await detectWeatherState();\r\n      applyWeather(state);\r\n      setWx(state);\r\n      localStorage.setItem(CACHE_KEY, JSON.stringify({ wx: state, t: Date.now() }));\r\n    })();\r\n\r\n    const vis = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        const c = getCached();\r\n        if (!c || Date.now() - c.t > TTL_MS) {\r\n          localStorage.removeItem(CACHE_KEY);\r\n          location.reload();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', vis);\r\n    return () => document.removeEventListener('visibilitychange', vis);\r\n  }, []);\r\n\r\n  return wx;\r\n}\r\n","import { PropsWithChildren, useEffect } from 'react';\r\n\r\nexport type MotionPref = 'ok' | 'reduce';\r\n\r\nexport default function SeasonalUIProvider({ children }: PropsWithChildren) {\r\n  useEffect(() => {\r\n    const reduced = matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n    document.documentElement.dataset.motion = reduced ? 'reduce' : 'ok';\r\n  }, []);\r\n  return children as any;\r\n}\r\n"],"names":["detectSeason","config","now","m","day","r","res","applySeason","season","getCoords","timeoutMs","resolve","pos","detectWeatherState","opts","lat","lon","coords","url","j","code","wind","applyWeather","wx","PARAM","useSeasonalTheme","init","setSeason","useState","useEffect","qs","s","CACHE_KEY","TTL_MS","getCached","useWeatherTheme","setWx","manual","cached","state","vis","c","SeasonalUIProvider","children","reduced"],"mappings":"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"}