{"version":3,"file":"index.cjs","sources":["../src/seasonal.ts","../src/weather.ts","../src/useSeasonalTheme.tsx","../src/useWeatherTheme.tsx","../src/provider/SeasonalUIProvider.tsx"],"sourcesContent":["export type SeasonKey = 'default' | 'halloween' | 'christmas' | 'thanksgiving' | 'easter';\r\n\r\nexport interface SeasonalConfig {\r\n  /** force a season (e.g., for screenshots) */\r\n  override?: SeasonKey | null;\r\n  /** timezone offset or explicit Date provider if you need server time */\r\n  now?: () => Date;\r\n  /** optional custom rules */\r\n  rules?: Array<(d: Date) => SeasonKey | null>;\r\n}\r\n\r\n/** Simple US-centric defaults; override via config.rules as needed. */\r\nexport function detectSeason(config: SeasonalConfig = {}): SeasonKey {\r\n  if (config.override) return config.override;\r\n  const now = (config.now ? config.now() : new Date());\r\n  const m = now.getMonth() + 1;\r\n  const day = now.getDate();\r\n\r\n  for (const r of config.rules ?? []) {\r\n    const res = r(now);\r\n    if (res) return res;\r\n  }\r\n\r\n  // Halloween: Oct 1–31\r\n  if (m === 10) return 'halloween';\r\n  // Thanksgiving: Nov 15–30\r\n  if (m === 11 && day >= 15 && day <= 30) return 'thanksgiving';\r\n  // Christmas: Dec 1–26\r\n  if (m === 12 && day <= 26) return 'christmas';\r\n\r\n  // Easter (approx): any Sunday in April → 'easter' (you can replace with real calc via config.rules)\r\n  if (m === 4) {\r\n    if (now.getDay() === 0) return 'easter';\r\n  }\r\n\r\n  return 'default';\r\n}\r\n\r\n/** Apply to <html data-season=\"...\"> */\r\nexport function applySeason(season: SeasonKey) {\r\n  document.documentElement.dataset.season = season;\r\n}\r\n","export type WeatherState = 'clear' | 'cloudy' | 'rain' | 'snow' | 'storm' | 'fog' | 'wind';\r\n\r\nexport interface WeatherOptions {\r\n  lat?: number;\r\n  lon?: number;\r\n  override?: WeatherState | null;  // e.g., ?weather=snow\r\n  timeoutMs?: number;              // geolocation timeout\r\n}\r\n\r\nexport async function getCoords(timeoutMs = 8000): Promise<{lat:number; lon:number} | null> {\r\n  if (!('geolocation' in navigator)) return null;\r\n  return new Promise((resolve) => {\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos) => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),\r\n      () => resolve(null),\r\n      { enableHighAccuracy: true, timeout: timeoutMs }\r\n    );\r\n  });\r\n}\r\n\r\nexport async function detectWeatherState(opts: WeatherOptions = {}): Promise<WeatherState> {\r\n  if (opts.override) return opts.override;\r\n\r\n  const lat = opts.lat;\r\n  const lon = opts.lon;\r\n\r\n  let coords = (lat && lon) ? {lat, lon} : (await getCoords(opts.timeoutMs ?? 8000));\r\n  if (!coords) coords = { lat: 40.7128, lon: -74.0060 }; // NYC fallback\r\n\r\n  const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=weather_code,precipitation,wind_speed_10m`;\r\n  const r = await fetch(url);\r\n  const j = await r.json();\r\n  const code: number = j?.current?.weather_code ?? 0;\r\n  const wind: number = j?.current?.wind_speed_10m ?? 0;\r\n\r\n  if ([71,73,75,77,85,86].includes(code)) return 'snow';\r\n  if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return 'rain';\r\n  if ([95,96,99].includes(code)) return 'storm';\r\n  if ([45,48].includes(code)) return 'fog';\r\n  if (wind >= 12 && [0,1,2,3].includes(code)) return 'wind';\r\n  if ([1,2,3].includes(code)) return 'cloudy';\r\n  return 'clear';\r\n}\r\n\r\nexport function applyWeather(wx: WeatherState) {\r\n  document.documentElement.dataset.wx = wx;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { detectSeason, applySeason, SeasonKey } from './seasonal';\r\n\r\nconst PARAM = 'season';\r\n\r\nexport function useSeasonalTheme(init?: {override?: SeasonKey | null}) {\r\n  const [season, setSeason] = useState<SeasonKey>('default');\r\n\r\n  useEffect(() => {\r\n    const qs = new URLSearchParams(location.search).get(PARAM) as SeasonKey | null;\r\n    const s = detectSeason({ override: init?.override ?? qs });\r\n    applySeason(s);\r\n    setSeason(s);\r\n  }, []);\r\n\r\n  return season;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { detectWeatherState, applyWeather, WeatherState } from './weather';\r\n\r\nconst PARAM = 'weather';\r\nconst CACHE_KEY = 'seasonal-ui:wx';\r\nconst TTL_MS = 15 * 60 * 1000;\r\n\r\nfunction getCached(): {wx: WeatherState; t: number} | null {\r\n  try { return JSON.parse(localStorage.getItem(CACHE_KEY) || 'null'); } catch { return null; }\r\n}\r\n\r\nexport function useWeatherTheme() {\r\n  const [wx, setWx] = useState<WeatherState>('clear');\r\n\r\n  useEffect(() => {\r\n    const manual = new URLSearchParams(location.search).get(PARAM) as WeatherState | null;\r\n    if (manual) {\r\n      applyWeather(manual);\r\n      setWx(manual);\r\n      return;\r\n    }\r\n\r\n    const cached = getCached();\r\n    if (cached && Date.now() - cached.t < TTL_MS) {\r\n      applyWeather(cached.wx);\r\n      setWx(cached.wx);\r\n      return;\r\n    }\r\n\r\n    (async () => {\r\n      const state = await detectWeatherState();\r\n      applyWeather(state);\r\n      setWx(state);\r\n      localStorage.setItem(CACHE_KEY, JSON.stringify({ wx: state, t: Date.now() }));\r\n    })();\r\n\r\n    const vis = () => {\r\n      if (document.visibilityState === 'visible') {\r\n        const c = getCached();\r\n        if (!c || Date.now() - c.t > TTL_MS) {\r\n          localStorage.removeItem(CACHE_KEY);\r\n          location.reload();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', vis);\r\n    return () => document.removeEventListener('visibilitychange', vis);\r\n  }, []);\r\n\r\n  return wx;\r\n}\r\n","import { PropsWithChildren, useEffect } from 'react';\r\n\r\nexport type MotionPref = 'ok' | 'reduce';\r\n\r\nexport default function SeasonalUIProvider({ children }: PropsWithChildren) {\r\n  useEffect(() => {\r\n    const reduced = matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n    document.documentElement.dataset.motion = reduced ? 'reduce' : 'ok';\r\n  }, []);\r\n  return children as any;\r\n}\r\n"],"names":["detectSeason","config","now","m","day","r","res","applySeason","season","getCoords","timeoutMs","resolve","pos","detectWeatherState","opts","lat","lon","coords","url","j","code","wind","applyWeather","wx","PARAM","useSeasonalTheme","init","setSeason","useState","useEffect","qs","s","CACHE_KEY","TTL_MS","getCached","useWeatherTheme","setWx","manual","cached","state","vis","c","SeasonalUIProvider","children","reduced"],"mappings":"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"}